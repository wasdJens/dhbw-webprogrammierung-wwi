@if (beer(); as beerDetail) {
<main class="detail-page">
  <div class="beer-illustration" aria-hidden="true">
    <svg viewBox="0 0 500 600">
      <defs>
        <linearGradient id="krugFoam" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" stop-color="#fffef5" />
          <stop offset="100%" stop-color="#ffe6c0" />
        </linearGradient>
        <linearGradient id="krugBeer" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" stop-color="#ffe48a" />
          <stop offset="45%" stop-color="#ffbf36" />
          <stop offset="100%" stop-color="#cb7100" />
        </linearGradient>
        <linearGradient id="krugShine" x1="0%" y1="0%" x2="100%" y2="0%">
          <stop offset="0%" stop-color="rgba(255,255,255,0.6)" />
          <stop offset="40%" stop-color="rgba(255,255,255,0.2)" />
          <stop offset="100%" stop-color="rgba(255,255,255,0.35)" />
        </linearGradient>
      </defs>

      <path
        class="krug-handle"
        d="M360 140h50c42 0 74 28 74 72v130c0 44-32 72-74 72h-50z"
      ></path>
      <path
        class="krug-handle-inner"
        d="M390 180h18c20 0 32 12 32 32v80c0 20-12 32-32 32h-18z"
      ></path>

      <rect class="krug-body" x="120" y="90" width="240" height="360" rx="50" ry="50"></rect>
      <rect
        class="krug-beer"
        x="140"
        y="130"
        width="200"
        height="320"
        rx="35"
        fill="url(#krugBeer)"
      ></rect>

      <g class="krug-dimples">
        <ellipse cx="190" cy="190" rx="38" ry="48"></ellipse>
        <ellipse cx="260" cy="190" rx="38" ry="48"></ellipse>
        <ellipse cx="190" cy="270" rx="38" ry="48"></ellipse>
        <ellipse cx="260" cy="270" rx="38" ry="48"></ellipse>
        <ellipse cx="190" cy="350" rx="38" ry="48"></ellipse>
        <ellipse cx="260" cy="350" rx="38" ry="48"></ellipse>
      </g>

      <path
        class="krug-foam"
        d="M100 140c0-55 55-85 150-85s170 15 170 85c0 40-30 65-65 65-45 0-60-30-110-30s-80 30-130 30c-35 0-60-25-60-65z"
        fill="url(#krugFoam)"
      ></path>
      <circle class="foam-bubble" cx="180" cy="125" r="18"></circle>
      <circle class="foam-bubble" cx="240" cy="105" r="14"></circle>
      <circle class="foam-bubble" cx="300" cy="125" r="12"></circle>

      <path class="krug-outline" d="M120 90h240v320c0 85-40 150-120 150s-120-65-120-150z"></path>
      <path class="krug-base" d="M90 420h300v60c-35 45-90 70-150 70s-115-25-150-70z"></path>
      <path class="krug-shine" d="M150 150h45v240c0 45-12 80-40 100"></path>
      <circle class="shine" cx="165" cy="210" r="65" fill="url(#krugShine)"></circle>

      <circle class="bubble" cx="210" cy="290" r="10"></circle>
      <circle class="bubble" cx="250" cy="340" r="8"></circle>
      <circle class="bubble" cx="220" cy="380" r="6"></circle>
      <circle class="bubble" cx="270" cy="310" r="7"></circle>
      <circle class="bubble" cx="200" cy="330" r="5"></circle>
    </svg>
  </div>
  <mat-card class="detail-card">
    <div class="card-header">
      <div>
        <p class="eyebrow">Bierprofil</p>
        <h1>{{ beerDetail.name }}</h1>
        <p class="meta">
          {{ detailForm.controls.brand.value || beerDetail.brand }} ·
          {{ detailForm.controls.taste.value || beerDetail.taste }} · Bereits getrunken:
          {{ detailForm.controls.amount.value }} Biere
        </p>
      </div>
      <div class="header-actions">
        <a mat-stroked-button color="accent" routerLink="/beers">
          <mat-icon>arrow_back</mat-icon>
          Zurück zur Übersicht
        </a>
      </div>
    </div>
    <mat-divider></mat-divider>
    <div class="readout">
      <div class="stat">
        <mat-icon>star_rate</mat-icon>
        <div>
          <p>Bewertung</p>
          <strong> {{ detailForm.controls.rating.value | number : '1.1-1' }} / 5 </strong>
        </div>
      </div>
      <div class="stat">
        <mat-icon>sports_bar</mat-icon>
        <div>
          <p>Bereits getrunken</p>
          <strong>{{ detailForm.controls.amount.value }} Biere</strong>
        </div>
      </div>
    </div>
    <form class="detail-form" [formGroup]="detailForm" (ngSubmit)="save()" novalidate>
      <div class="form-grid">
        <mat-form-field appearance="outline">
          <mat-label>Name</mat-label>
          <input matInput formControlName="name" autocomplete="off" />
          @if (detailForm.controls.name.hasError('required')) {
          <mat-error>Name ist erforderlich.</mat-error>
          } @if (detailForm.controls.name.hasError('maxlength')) {
          <mat-error>Maximal 120 Zeichen.</mat-error>
          }
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Marke / Brauerei</mat-label>
          <input matInput formControlName="brand" autocomplete="off" />
          @if (detailForm.controls.brand.hasError('required')) {
          <mat-error>Marke ist erforderlich.</mat-error>
          } @if (detailForm.controls.brand.hasError('maxlength')) {
          <mat-error>Maximal 120 Zeichen.</mat-error>
          }
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Stil / Geschmack</mat-label>
          <mat-select formControlName="taste">
            @for (taste of tasteOptions; track taste) {
            <mat-option [value]="taste">{{ taste }}</mat-option>
            }
          </mat-select>
          @if (detailForm.controls.taste.hasError('required')) {
          <mat-error>Bitte wähle einen Stil.</mat-error>
          }
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Bereits konsumiert</mat-label>
          <input matInput type="number" min="0" formControlName="amount" />
          @if (detailForm.controls.amount.hasError('required')) {
          <mat-error> Anzahl ist erforderlich. </mat-error>
          } @if (detailForm.controls.amount.hasError('min')) {
          <mat-error>Anzahl darf nicht negativ sein.</mat-error>
          }
        </mat-form-field>
      </div>
      <div class="rating-control">
        <label>Bewertung aktualisieren</label>
        <div class="slider-row">
          <mat-slider min="0" max="5" step="1" discrete showTickMarks>
            <input formControlName="rating" matSliderThumb />
          </mat-slider>
          <span class="rating-value">
            {{ detailForm.controls.rating.value | number : '1.1-1' }} / 5
          </span>
        </div>
      </div>
      @if (isSaving()) {
      <mat-progress-bar mode="indeterminate"></mat-progress-bar>
      }
      <div class="form-actions">
        <button mat-flat-button color="primary" type="submit" [disabled]="isSaving()">
          <mat-icon>save</mat-icon>
          Änderungen speichern
        </button>
        <button mat-stroked-button color="accent" type="button" routerLink="/beers">
          Abbrechen
        </button>
      </div>
      @if (saveMessage()) {
      <p class="success">{{ saveMessage() }}</p>
      } @if (errorMessage()) {
      <p class="error">{{ errorMessage() }}</p>
      }
    </form>
  </mat-card>
</main>
}
